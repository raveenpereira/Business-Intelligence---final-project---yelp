<html>
<head>
  <meta charset="utf-8"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<link href="bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.min.css">
<script src="https://d3js.org/d3.v3.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.css">
<script src="c3-0.4.11/c3.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animsition/4.0.2/css/animsition.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/animsition/4.0.2/js/animsition.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css">
  <!-- Load d3.js and c3.js -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.3/nv.d3.js"></script>
  <script src ="https://raw.github.com/ducksboard/gridster.js/master/dist/jquery.gridster.min.js">
</script>
  <script type="text/javascript" src="https://raw.github.com/ducksboard/gridster.js/master/dist/jquery.gridster.min.js"></script>

  <link rel="stylesheet" href="ducksboard-gridster.js-3140374/src/jquery.gridster.css" />
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.coords.js" /></script>
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.collision.js" /></script>
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.draggable.js" /></script>
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.gridster.extras.js" /></script>
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.gridster.js" /></script>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
  <script src="//code.jquery.com/jquery-1.12.4.js"></script>
  <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script type="text/javascript" scr="helper.js"></script>
</head>
<style>
body{
  background-color: white;
  color: black;
  font-family: 'junction';

}
tr,td{
  padding:15px;
}
#map {
  height: 300px;
  width:590px;
  border-radius: 20px;
  float:left;
  margin-bottom: 20px;

}

#features{
  float:right;
  margin-left: 10px;
}
#ambience{
  width:300px;
  height:300px;
margin-bottom: 20px;
  margin-left: -20px;
  float:left;
}
#goodfor{
  width:300px;
  height:300px;

 margin-right: 30px;
 margin-top: 10px;
 margin-bottom: 20px;

  float:right;
}
#more{
  margin-top: 50px;
  height:125px;
  width:400px;
}
#title-bar {
  color:grey;

  background-color:#CCCCCC;
  color:white;
  border: solid white 0.5px;
  border-radius: 5px;

}
ul.nav-pills >li>a:hover,
.nav-pills >li>a:focus {
    text-decoration: none;
    background-color: #2C3539;
}
ul.nav-pills>li>a{
  color:#FF6600;
}
ul.nav-pills>li.active>a{
  background-color:#000000;

}
@font-face {
    font-family: 'junction';
    src: url('junction/Junction-light.otf');
}
</style>
<script>
var citycategory;
var latnew,lngnew;
var featurescity;
$(document).ready(function(){
var x=localStorage.getItem('city');
var y=localStorage.getItem('category');
console.log(x);
console.log(y);

if(x=='Phoneix'&&y=='Asian'){

  console.log("inside here");
  citycategory='latlngphoenixasian.py';
}
if(x=='Phoneix'&&y=='Fast Food'){
  citycategory='latlngphoenixfastfood.py';
}
if(x=='Phoneix'&&y=='Sandwiches'){
  citycategory='latlngphoenixsandwiches.py';
}
if(x=='Phoneix'&&y=='Bar'){
  citycategory='latlngphoenixbar.py';
}
if(x=='Phoneix'&&y=='American'){
  citycategory='latlngphoenixamerican.py';
}
if(x=='Charlotte'&&y=='Asian'){
  citycategory='latlngcharlotteasian.py';
}
if(x=='Charlotte'&&y=='Fast Food'){
  citycategory='latlngcharlottefastfood.py';
}
if(x=='Charlotte'&&y=='Sandwiches'){
  citycategory='latlngcharlottesandwiches.py';
}
if(x=='Charlotte'&&y=='Bar'){
  citycategory='latlngcharlottebar.py';
}
if(x=='Charlotte'&&y=='American'){
  citycategory='latlngcharlotteamerican.py';

}
if(x=='Las Vegas'&&y=='Asian'){
  citycategory='latlngvegasasian.py';
  console.log(citycategory);
}
if(x=='Las Vegas'&&y=='Fast Food'){
  citycategory='latlngvegasfastfood.py';
}
if(x=='Las Vegas'&&y=='Sandwiches'){
  citycategory='latlngvegassandwiches.py';
}
if(x=='Las Vegas'&&y=='Bar'){
  citycategory='latlngvegasbar.py';
}
if(x=='Las Vegas'&&y=='American'){
  citycategory='latlngvegasamerican.py';
}
if(x=='Montreal'&&y=='Asian'){
  citycategory='latlngmontrealasian.py';
}
if(x=='Montreal'&&y=='Fast Food'){
  citycategory='latlngmontrealfastfood.py';
}
if(x=='Montreal'&&y=='Sandwiches'){
  citycategory='latlngmontrealsandwiches.py';
}
if(x=='Montreal'&&y=='Bar'){
  citycategory="latlngmontrealbar.py";
}
if(x=='Montreal'&&y=='American'){
  citycategory='latlngmontrealamerican.py';
}
if(x=='Pittsburgh'&&y=='Asian'){
  citycategory='latlngpittsasian.py';
}
if(x=='Pittsburgh'&&y=='Fast Food'){
  citycategory='latlngpittsfastfood.py';
}
if(x=='Pittsburgh'&&y=='Sandwiches'){
  citycategory='latlngpittssandwiches.py';
}
if(x=='Pittsburgh'&&y=='Bar'){
  citycategory='latlngpittsbar.py';
}
if(x=='Pittsburgh'&&y=='American'){
  citycategory='latlngpittsamerican.py';
}
if(x=='Phoneix'){
  latnew=33.448376;
  lngnew=-112.074036;
  localStorage.setItem('latnew',latnew);
  localStorage.setItem('lngnew',lngnew);
  //alert(lngnew);
  featurescity='featuresphoenix.py'
}
if(x=='Pittsburgh'){
  latnew=40.440624;
  lngnew=-79.995888;
  featurescity='featurespitts.py'
  //alert(lngnew);

}
if(x=='Charlotte'){
  latnew=35.185892;
  lngnew=-80.82588;
  featurescity='featurescharlotte.py'
  //alert(lngnew);

}
if(x=='Las Vegas'){
  latnew=36.114647;
  lngnew=-115.17281;
  featurescity='featuresvegas.py'
  //alert(lngnew);

}
if(x=='Montreal'){
  latnew=45.524269;
  lngnew=-73.652977;
  featurescity='featuresmontreal.py'

}


  console.log(x);
  console.log(y);
  console.log(window.citycategory);



  var a=[],a1,b1,a2,b2,a3,b3;
  //var map;
  $.ajax({
    url:window.citycategory,
    dataType:"json",
    type:"GET",
    contentType:"application/json;charset=utf-8",
    success:function(data){
      console.log(window.citycategory);
      $.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyAgbFYEC5vlebJD4foUVebLwa4CQ6NVdbw&libraries=visualization&callback=initMap", function(){});

          a1=data[0].latitude;
          b1=data[0].longitude;
          //alert("heyyegoyudbfljahdbzfl");
      //    a2=data[1].latitude;
      //    b2=data[1].longitude;
      //    a3=data[2].latitude;
      //    b3=data[2].longitude;
          localStorage.setItem('a1',a1);
            localStorage.setItem('b1',b1);
        //      localStorage.setItem('a2',a2);
          //      localStorage.setItem('b2',b2);
            //      localStorage.setItem('a3',a3);
              //      localStorage.setItem('b3',b3);

          var latcenter,longcenter;
      window.initMap = function() {
        var map;

           map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: {lat: parseFloat(latnew), lng: parseFloat(lngnew)},
            mapTypeId: 'roadmap'
          });



      heatmap = new google.maps.visualization.HeatmapLayer({
        data: getPoints(),
        map: map,
        radius:80
      });
    }
    function getPoints() {
      return [
        new google.maps.LatLng(a1, b1),
      //  new google.maps.LatLng(a2, b2),
      //  new google.maps.LatLng(a3, b3)

      ];
    }

},
error:function (data) {
  console.log(data);
}
  });

  $.ajax({
    url:featurescity,
    dataType:"json",
    contentType:"application/json;charset=utf-8",
    type:"GET",
    success:function(data){
    //  console.log(data[0].length);
      a=data.sort();
    //  console.log(a);
      const sorted = Object.keys(data[0]).sort((a, b) => data[0][b] - data[0][a]);
     console.log(sorted);
      sorted.forEach(x => console.log(x + ': ' + data[0][x]));
    //  document.getElementById("features").innerHTML = sorted.slice(0,7);
    var final='<table>';
    var image;
    var sum=0;
    for(i=0;i<sorted.length;i++){
      sum+=(data[0][sorted[i]]*1);
     console.log(sum);
    //  console.log(data[0][sorted[i]]);
    }
    final+='<h2><Strong>Features that are an Absolute must</strong></h2>'
    for(i=0;i<9;i++){
      if(sorted[i]=='Good For Groups')
        image='groups.png';
      else if(sorted[i]=='Alcohol')
        image='alcohol.png'
        else if(sorted[i]=='Accept Credit Cards')
          image='creditcard.png'
          else if(sorted[i]=='Wi-Fi')
            image='wifi.png'
            else if(sorted[i]=='Take-Out')
              image='takeout.png'
              else if(sorted[i]=='Coat Check')
                image='alcohol.png'
                else if(sorted[i]=='Takes Reservations')
                  image='reservations.png'
                  else if(sorted[i]=='Wheelchair Accessible')
                    image='wheelchair.png'
                    else if(sorted[i]=='Outdoor Seating')
                      image='outdoorseating.png'
                      else if(sorted[i]=='Dogs Allowed')
                        image='dogs.png'
                        else if(sorted[i]=='Smoking')
                          image='smoking.png'
                          else if(sorted[i]=='Waiter Service')
                            image='waiterservice.png'
                            else if(sorted[i]=='Alcohol')
                              image='catering.png'
                              else if(sorted[i]=='Has TV')
                                image='hastv1.png'
                                else if(sorted[i]=='Caters')
                                  image='catering.png'
                                  else
                                    image='drive1.png'

     final+="<p style=\"font-size:20px;\"><img src=\""+image +"\"style=\"width:60px;height:30px;margin-right:15px;border-radius:10px;font-size:100px;\">"+sorted[i]+'\xa0\xa0\xa0\xa0\xa0'+Math.floor((data[0][sorted[i]])/sum*100)+"%"+"</p>";
   }
   final+='<h2><Strong>Additional Features to consider</strong></h2> ';
   for(i=9;i<sorted.length;i++){
     if(sorted[i]=='Good For Groups')
       image='groups.png';
     else if(sorted[i]=='Alcohol')
       image='alcohol.png'
       else if(sorted[i]=='Accept Credit Cards')
         image='creditcard.png'
         else if(sorted[i]=='Wi-Fi')
           image='wifi.png'
           else if(sorted[i]=='Take-Out')
             image='takeout.png'
             else if(sorted[i]=='Coat Check')
               image='alcohol.png'
               else if(sorted[i]=='Takes Reservations')
                 image='reservations.png'
                 else if(sorted[i]=='Wheelchair Accessible')
                   image='wheelchair.png'
                   else if(sorted[i]=='Outdoor Seating')
                     image='outdoorseating.png'
                     else if(sorted[i]=='Dogs Allowed')
                       image='dogs.png'
                       else if(sorted[i]=='Smoking')
                         image='smoking.png'
                         else if(sorted[i]=='Waiter Service')
                           image='waiterservice.png'
                           else if(sorted[i]=='Alcohol')
                             image='catering.png'
                             else if(sorted[i]=='Has TV')
                               image='hastv1.png'
                               else if(sorted[i]=='Caters')
                                 image='catering.png'
                                 else
                                   image='drive1.png'
     final+="<p style=\"font-size:20px;\"><img src=\""+image +"\"style=\"width:60px;height:30px;margin-right:15px;border-radius:10px;font-size:100px;\">"+sorted[i]+'\xa0\xa0\xa0\xa0\xa0\xa0'+Math.floor((data[0][sorted[i]])/sum*100)+"%"+"</p>";

   }
   console.log(final);
       document.getElementById("features").innerHTML += final;

    }
  });
  $.ajax({
  url:"ambience.py",
  type: "POST",
  dataType: "json",
  data:JSON.stringify({data:localStorage.getItem('category'),data2:localStorage.getItem('city')}),
  contentType: "application/json",
  success:function(data){
    console.log(data);
    var obj=data;
    //console.log(data);
    var a = Object.keys(obj[0]).map(function(key) {
  // return [key, obj[0][key]];
  return {label:key,value: obj[0][key]}

  });

  //  console.log(JSON.stringify(a, null, 4));
    nv.addGraph(function() {
      var chart = nv.models.pieChart()
          .x(function(d) { return d.label })
          .y(function(d) { return d.value })
          .showLabels(true)     //Display pie labels
          .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
          .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
          .donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
          .donutRatio(0.35)     //Configure how big you want the donut hole size to be.
          ;

        d3.select("#ambience svg")
            .datum(a)
            .transition().duration(350)
            .call(chart);


      return chart;
    });

  },
  error: function(xhr, status, error) {
  //  console.log(status);
  //  console.log(error);
    console.log(xhr.responseText);
  }

  });
  $.ajax({
  url:"goodfor.py",
  type: "POST",
  data:JSON.stringify({data:localStorage.getItem('category'),data2:localStorage.getItem('city')}),
  dataType: "json",
  contentType: "application/json",
  success:function(data){
    console.log(data);
    var obj=data;
    //console.log(data);
    var a = Object.keys(obj[0]).map(function(key) {
  // return [key, obj[0][key]];
  return {label:key,value: obj[0][key]}

  });

  //  console.log(JSON.stringify(a, null, 4));
    nv.addGraph(function() {
      var chart = nv.models.pieChart()
          .x(function(d) { return d.label })
          .y(function(d) { return d.value })
          .showLabels(true)     //Display pie labels
          .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
          .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
          .donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
          .donutRatio(0.35)     //Configure how big you want the donut hole size to be.
          ;

        d3.select("#goodfor svg")
            .datum(a)
            .transition().duration(350)
            .call(chart);

      return chart;
    });

  },
  error: function(xhr, status, error) {
  //  console.log(status);
  //  console.log(error);
  }

  });
});

  </script>
  <script>
  function moreplaces() {

    console.log("hi");
    window.open("index6.html","","width=500,height=600");

  }

  </script>
<body>
  <div id="container" class="container">
  <nav class="navbar navbar-inverse"id="title-bar">

    <div class="container-fluid">

    </div>
    <ul  class="nav nav-pills">
			<li style=" margin-top:5px;">

        <a  href="index.html" data-animsition-out-class="fade-out-right"
  data-animsition-out-duration="2000" data-toggle="tab">Dashboard</a>
			</li>
			<li class="active"> <a href="index3.html"  data-animsition-out-class="fade-out-right"
  data-animsition-out-duration="2000" data-toggle="tab" style="margin-top:5px;">Map</a>

			</li>


		</ul>


  </nav>

    <div>
  <div id="map"></div>
  <div id="features"></div>
  <div id="ambience"><svg></svg></div>
  <div id="goodfor"><svg></svg></div>
</div>
<div id="more">Click Here To See Similar Restaurants Near You!  <button id="openmore" onclick="moreplaces()" >GO!</button></div>

</div>
</body>
</html>
