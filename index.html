<html>
<title>testing</title>
<head>
  <meta charset="utf-8"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<link href="bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.min.css">
<script src="https://d3js.org/d3.v3.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animsition/4.0.2/css/animsition.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/animsition/4.0.2/js/animsition.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.css">
<script src="c3-0.4.11/c3.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css">
  <!-- Load d3.js and c3.js -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.3/nv.d3.js"></script>
  <script  type="text/javascript"src ="https://raw.github.com/ducksboard/gridster.js/master/dist/jquery.gridster.min.js">
</script>
<script  type="text/javascript"src ="gridster.js">
</script>

  <link rel="stylesheet" href="ducksboard-gridster.js-3140374/src/jquery.gridster.css" />
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.coords.js" /></script>
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.collision.js" /></script>
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.draggable.js" /></script>
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.gridster.extras.js" /></script>
  <script type="text/javascript" src="ducksboard-gridster.js-3140374/src/jquery.gridster.js" /></script>
</head>
<style>
.tick line {
  display: none;
}
ul{
  list-style: none;
}
#title-bar {
  color:grey;
  background-color:#b8dbf3;
  background-color:#CCCCCC;
  color:white;
  border: solid white 0.5px;

}
ul.nav-pills >li>a:hover,
.nav-pills >li>a:focus {
    text-decoration: none;
    background-color: #134b71;
}
ul.nav-pills>li>a{
  color:#FF6600;
}
ul.nav-pills>li.active>a{
  background-color:#000000;

}
</style>
<body>
  <script type="text/javascript">


  var gridster;
        $(function(){
          var log = document.getElementById('log');
          gridster = $(".gridster ul").gridster({
            widget_base_dimensions: [140, 100],
            widget_margins: [5,15],
            resize: {
              enabled: false,

            }
          }).data('gridster');
        });
  </script>

  <div class="container">
    <nav class="navbar navbar-inverse"id="title-bar">

      <div class="container-fluid">

      </div>
      <ul  class="nav nav-pills">
        <li class="active" style=" margin-top:5px;">

          <a  href="index.html" data-toggle="tab">Dashboard</a>
        </li>
        <li><a href="index2.html"  data-toggle="tab" style="margin-top:5px;">Map</a>

        </li>


      </ul>


    </nav>
    <div style="margin-right:120px;">
    <div id="menubar" style="margin-left:130px;"></div>
  <div class="gridster" style="margin-left:120px;">
    <ul>
      <li data-row="2" data-col="3" data-sizex="2" data-sizey="3">
        <div id="chart1" style="height:300px;width:280px;border:1px solid lightgrey; border-radius: 10px;"><svg></svg>

        </div>
        <div id="text1" style="text-align: center;color:grey;">Price Range</div>
      </li>
      <li data-row="1" data-col="2" data-sizex="2" data-sizey="3">
        <div id="chart2" style="height:300px;width:280px;border:1px solid lightgrey; border-radius: 10px;"><svg></svg>

        </div>
        <div id="text2" style="text-align: center;color:grey;">Restaurants By State</div>
      </li>
      <li data-row="1" data-col="3" data-sizex="2" data-sizey="3">
        <div id="chart3" style="height:300px;width:280px;border:1px solid lightgrey; border-radius: 10px;"><svg></svg>

        </div>
        <div id="text3" style="text-align: center;color:grey;">Parking</div>
      </li>
      <li data-row="2" data-col="1" data-sizex="2" data-sizey="3">
        <div id="chart4" style="height:300px;width:280px;border:1px solid lightgrey; border-radius: 10px;"><svg></svg>

        </div>
        <div id="text4" style="text-align: center;color:grey;">Noise Level</div>
      </li>
      <li data-row="1" data-col="1" data-sizex="2" data-sizey="3">
        <div id="chart6" style="opacity:0.8;font-size: 80px;text-align: center; display: table-cell;height:300px;width:280px;vertical-align:middle;border:1px solid lightgrey; border-radius: 10px;"><svg></svg>

        </div>
        <div id="text6" style="text-align:center;vertical-align:middle;color:grey;">No. Of Restaurants</div>
      </li>
      <li data-row="2" data-col="2" data-sizex="2" data-sizey="3">
        <div id="chart5" style="height:300px;width:280px;border:1px solid lightgrey; border-radius: 10px;"><svg></svg>

        </div>
        <div id="text5" style="text-align: center;color:grey;">Stars</div>
      </li>

    </ul>
  </div>
</div>
</div>

</div>


  <script>
  $(document).ready(function(){
  //  console.log("ready");

    $.ajax({
    url:"pricerange.py",
    type: "GET",
    dataType: "json",
    contentType: "application/json; charset=utf-8",
    success:function(data){
      console.log(data);
      var obj=data;
      var a1 = Object.keys(obj[0]).map(function(key) {
// return [key, obj[0][key]];
  return {label:key,value: obj[0][key]}
  });
  console.log(a1);
      var a = data.map(function(key) {
          console.log(key);
          a=key._id;
          if(a==null) a=5
          return {label:a,value: key.value}
          });
      var b=format1();
      function format1() {
        return[{key:"Price Range",
                values:a1}]
      }
      console.log(b);
    //  console.log(JSON.stringify(a, null, 4));
    cc=100;
    dd=28000;

    var data1=[];
    var largest;
    var smallest;
      nv.addGraph(function() {


  var chart = nv.models.discreteBarChart()
    .x(function(d) { return d.label })
    .y(function(d) {
      return d.value })
        .yDomain([0,12000])

    //  .yDomain([d3.min(d3.values(data)),d3.max(d3.values(data))])

  //.forceY(1000)
  //  .staggerLabels(true)
    //.tooltips(false)
    //.showValues(true)

  d3.select('#chart1 svg')
    .datum(b)
    .transition().duration(500)
    .call(chart)
    ;

  nv.utils.windowResize(chart.update);

  return chart;
});

},
    error: function(xhr, status, error) {
      console.log(status);console.log(error);
}

  });

  });
  $.ajax({
  url:"indexpydrill.py",
  type: "GET",
  dataType: "json",
  contentType: "application/json; charset=utf-8",
  success:function(data){
    //console.log(data);
    var obj=data;
    var a = data.map(function(key) {
      //  console.log(key);
        a=key.city;
        if (a=='MontrĂŠa') {
            return {label:"Montreal",value:key.totalreviews}
        }else
        return {label:a,value:key.totalreviews}
        });
    var b=format1();
    function format1() {
      return[{key:"Price Range",
              values:a}]
    }
  //  console.log(JSON.stringify(b, null, 4));
    nv.addGraph(function() {
var chart = nv.models.discreteBarChart()
  .x(function(d) { return d.label })
  .y(function(d) { return d.value })
    .yDomain([0, 5000])
  .staggerLabels(true)
  //.tooltips(false)
  //.showValues(true)

d3.select('#chart2 svg')
  .datum(b)
  .transition().duration(500)
  .call(chart)

  ;

nv.utils.windowResize(chart.update);

return chart;
});

},
  error: function(xhr, status, error) {
  //  console.log(status);
  //  console.log(error);
}

});
$.ajax({
url:"parkingdrill.py",
type: "GET",
dataType: "json",
contentType: "application/json; charset=utf-8",
success:function(data){
  var obj=data;
  //console.log(data);
  var a = Object.keys(obj[0]).map(function(key) {
// return [key, obj[0][key]];
return {label:key,value: obj[0][key]}

});

//  console.log(JSON.stringify(a, null, 4));
  nv.addGraph(function() {
    var chart = nv.models.pieChart()
        .x(function(d) { return d.label })
        .y(function(d) { return d.value })
        .showLabels(true)     //Display pie labels
        .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
        .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
        .donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
        .donutRatio(0.35)     //Configure how big you want the donut hole size to be.
        ;

      d3.select("#chart3 svg")
          .datum(a)
          .transition().duration(350)
          .call(chart);

    return chart;
  });

},
error: function(xhr, status, error) {
//  console.log(status);
//  console.log(error);
}

});
$.ajax({
url:"noiselevel.py",
type: "GET",
dataType: "json",
contentType: "application/json; charset=utf-8",
success:function(data){
  var obj=data;
  //console.log(data);
  var a = Object.keys(obj[0]).map(function(key) {
// return [key, obj[0][key]];
return {label:key,value: obj[0][key]}

});

//  console.log(JSON.stringify(a, null, 4));
  nv.addGraph(function() {
    var chart = nv.models.pieChart()
        .x(function(d) { return d.label })
        .y(function(d) { return d.value })
        .showLabels(true)     //Display pie labels
        .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
        .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
        .donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
        .donutRatio(0.35)     //Configure how big you want the donut hole size to be.
        ;

      d3.select("#chart4 svg")
          .datum(a)
          .transition().duration(350)
          .call(chart);

    return chart;
  });

},
error: function(xhr, status, error) {
//  console.log(status);
//  console.log(error);
}

});
$.ajax({
  url:"starsspline.py",
  type:"GET",
  dataType: "json",
  contentType: "application/json; charset=utf-8",
  success:function(data){
    var finaldata;
    length=[data].length;
  //  console.log(length);
    data1=data[0];
    var a=[];
  //  console.log(JSON.stringify(data1, null, 4));
    for(var key in data1){
      a.push(data1[key]);
  //  console.log(key + " -> " + data1[key]);

    }
    a.unshift('Stars');
  //  console.log(a);
    finaldata=calldata();
  //  console.log(JSON.stringify(finaldata, null, 4));
    function calldata(){
      return[['x1', 1, 1.5, 2, 2.5, 3, 3.5,4,4.5,5],a]
    }

    var chart = c3.generate({
      bindto: '#chart5 ',
      size: {
    height: 300,
     width: 260
 },
    data: {
      xs: {
          'Stars': 'x1',

      },
        columns: finaldata,
        types: {
            Stars: 'area-spline',

            // 'line', 'spline', 'step', 'area', 'area-step' are also available to stack
        },
        groups: [['data1', 'data2']]
    }
});

  }
});
$.ajax({
  url:"count.py",
  type:"GET",
  dataType:"json",
  contentType: "application/json; charset=utf-8",
  success:function(data){
    console.log(data);
    var div = document.getElementById('chart6');

    div.innerHTML = data[0].count;
  }

});

var xhr = new XMLHttpRequest();

xhr.onreadystatechange=function () {
  if (xhr.readyState == 4 && xhr.status == 200) {
    var jsonresponse=JSON.parse(xhr.responseText);
      var len=jsonresponse.length;
    //  console.log(jsonresponse[0]);
      var text = "<select data-placeholder=\"Select a City\"class=\"chosen-select\">";
      text+="<option selected value="+"select"+"></option>";
      for(i=0;i<len;i++){
        if (jsonresponse[i].city=='MontrĂŠa') {
            text+="<option value=\""+"Montreal"+"\">"+"Montreal"+"</option>";
        }else{
          text+="<option value=\""+jsonresponse[i].city+"\">"+jsonresponse[i].city+"</option>";
    }
      }
      text+="</select>";
    //  console.log(text);
  }
  document.getElementById("menubar").innerHTML = text;

  $(".chosen-select").chosen({width:280});
  $(".chosen-select").on('change',function (evt,params) {
  //    console.log(params.selected);
      changeChart(params.selected);
  });


};
xhr.open("GET", "indexpydrill.py", true);
xhr.send();
function changeChart(cityname) {
  if (cityname=="Las Vegas") {
    var a="parkingdrillvegas.py";
    var b="pricerangevegas.py";
    var c="noiselevelvegas.py";
    var d="starsvegas.py";
    var e="countvegas.py";
    var f="categoryvegas.py";
  }
  else if(cityname=="Phoenix"){
    var a="parkingdrillphoenix.py";
    var b="pricerangephoenix.py";
    var c="noiselevelphoenix.py";
    var d="starsphoenix.py";
    var e="countphoenix.py";
    var f="categoryphoenix.py";
  }
  else if(cityname=="Charlotte"){
    var a="parkingdrillcharlotte.py";
    var b="pricerangecharlotte.py";
    var c="noiselevelcharlotte.py";
    var d="starscharlotte.py";
    var e="countcharlotte.py";
    var f="categorycharlotte.py";
  }
  else if(cityname=="Pittsburgh"){
    var a="parkingdrillscottsdale.py";
    var b="pricerangescottsdale.py";
    var c="noiselevelscottsdale.py";
    var d="starsscottsdale.py";
    var e="countscottsdale.py";
    var f="categorypittsburgh.py";
  }
  else if(cityname=="Montreal"){
    var a="parkingdrillmontreal.py";
    var b="pricerangemontreal.py";
    var c="noiselevelmontreal.py";
    var d="starsmontreal.py";
    var e="countmontreal.py";
    var f="categorymontreal.py"
  }
  $.ajax({
    url:f,
    type: "GET",
    dataType: "json",
    contentType: "application/json; charset=utf-8",
    success:function(data){

      var obj=data;
      var a1 = Object.keys(obj).map(function(key) {
// return [key, obj[0][key]];
  if(obj[key].category=='Restaurants'){
    obj[key].category='Mexican'
  }
  if(obj[key].category=='Food'){
    obj[key].category='Sandwiches'
  }
  return {label:obj[key].category,value: obj[key].number}
  });
  console.log(a1);
  var b=format1();
  function format1() {
    return[{key:"Categories",
            values:a1}]
  }
  console.log(b);
  nv.addGraph(function() {


var chart = nv.models.discreteBarChart()
.x(function(d) { return d.label })
.y(function(d) {
  return d.value })
  .staggerLabels(true)


//  .yDomain([d3.min(d3.values(data)),d3.max(d3.values(data))])

//.forceY(1000)
//  .staggerLabels(true)
//.tooltips(false)
//.showValues(true)

d3.select('#chart2 svg')
.datum(b)
.transition().duration(500)
.call(chart)
;

nv.utils.windowResize(chart.update);

return chart;
});

    }

  });
    $.ajax({
    url:a,
    type: "GET",
    dataType: "json",
    contentType: "application/json; charset=utf-8",
    success:function(data){
      var obj=data;
  //    console.log(data);
      var a = Object.keys(obj[0]).map(function(key) {
    // return [key, obj[0][key]];
    return {label:key,value: obj[0][key]}

    });

  //    console.log(JSON.stringify(a, null, 4));
      nv.addGraph(function() {
        var chart = nv.models.pieChart()
            .x(function(d) { return d.label })
            .y(function(d) { return d.value })
            .showLabels(true)     //Display pie labels
            .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
            .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
            .donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
            .donutRatio(0.35)     //Configure how big you want the donut hole size to be.
            ;

          d3.select("#chart3 svg")
              .datum(a)
              .transition().duration(350)
              .call(chart);

        return chart;
      });

    },
    error: function(xhr, status, error) {
    //  console.log(status);
  //    console.log(error);
    }

    });
    $.ajax({
    url:b,
    type: "GET",
    dataType: "json",
    contentType: "application/json; charset=utf-8",
    success:function(data){
    //  console.log(data);
      var obj=data;
      var a1 = Object.keys(obj[0]).map(function(key) {
// return [key, obj[0][key]];
  return {label:key,value: obj[0][key]}
  });
  //console.log(a1);
      var a = data.map(function(key) {
        //  console.log(key);
          a=key._id;
          if(a==null) a=5
          return {label:a,value: key.value}
          });
      var b=format1();
      function format1() {
        return[{key:"Price Range",
                values:a1}]
      }
    //  console.log(JSON.stringify(a, null, 4));
      nv.addGraph(function() {
  var chart = nv.models.discreteBarChart()
    .x(function(d) { return d.label })
    .y(function(d) { return d.value })

  //  .yDomain([0, 27000])
  //  .staggerLabels(true)
    //.tooltips(false)
    //.showValues(true)

  d3.select('#chart1 svg')
    .datum(b)
    .transition().duration(500)
    .call(chart)
    ;

  nv.utils.windowResize(chart.update);

  return chart;
});

},
    error: function(xhr, status, error) {
    //  console.log(status);console.log(error);
}

  });
  $.ajax({
  url:c,
  type: "GET",
  dataType: "json",
  contentType: "application/json; charset=utf-8",
  success:function(data){
    var obj=data;
    //console.log(data);
    var a = Object.keys(obj[0]).map(function(key) {
  // return [key, obj[0][key]];
  return {label:key,value: obj[0][key]}

  });

  //  console.log(JSON.stringify(a, null, 4));
    nv.addGraph(function() {
      var chart = nv.models.pieChart()
          .x(function(d) { return d.label })
          .y(function(d) { return d.value })
          .showLabels(true)     //Display pie labels
          .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
          .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
          .donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
          .donutRatio(0.35)     //Configure how big you want the donut hole size to be.
          ;

        d3.select("#chart4 svg")
            .datum(a)
            .transition().duration(350)
            .call(chart);

      return chart;
    });

  },
  error: function(xhr, status, error) {
  //  console.log(status);
  //  console.log(error);
  }

  });
  $.ajax({
    url:d,
    type:"GET",
    dataType: "json",
    contentType: "application/json; charset=utf-8",
    success:function(data){
      var finaldata;
      length=[data].length;
      console.log(length);
      data1=data[0];
      var a=[];
    //  console.log(JSON.stringify(data1, null, 4));
      for(var key in data1){
        a.push(data1[key]);
  //    console.log(key + " -> " + data1[key]);

      }
      a.unshift('Stars');
  //    console.log(a);
      finaldata=calldata();
  //    console.log(JSON.stringify(finaldata, null, 4));
      function calldata(){
        return[['x1', 1, 1.5, 2, 2.5, 3, 3.5,4,4.5,5],a]
      }

      var chart = c3.generate({
        bindto: '#chart5 ',
        size: {
      height: 300,
       width: 280
   },
      data: {
        xs: {
            'Stars': 'x1',

        },
          columns: finaldata,
          types: {
              Stars: 'area-spline',

              // 'line', 'spline', 'step', 'area', 'area-step' are also available to stack
          },
          groups: [['data1', 'data2']]
      }
  });

    }
  });
  $.ajax({
    url:e,
    type:"GET",
    dataType:"json",
    contentType: "application/json; charset=utf-8",
    success:function(data){
      console.log(data);
      var div = document.getElementById('chart6');

      div.innerHTML = data[0].count;
    }

  });




}


  </script>
</body>

</html>
